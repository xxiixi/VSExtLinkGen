<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VS Code 插件下载链接生成器</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <style>
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .toast {
        animation: slideUp 0.3s ease-out forwards,
          slideDown 0.3s ease-in forwards 2.7s;
        transform: translateY(100px);
        opacity: 0;
      }
      @keyframes slideUp {
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes slideDown {
        to {
          transform: translateY(100px);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-indigo-600 mb-2">
          VS Code插件下载链接生成器
        </h1>
        <p class="text-gray-600">输入插件链接，自动生成下载链接</p>
      </div>

      <!-- 输入区域 -->
      <div class="bg-white rounded-xl shadow-md p-6 mb-8 card-hover">
        <!-- 引导提示 -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
          <div class="flex">
            <div class="flex-shrink-0">
              <i class="fas fa-info-circle text-blue-500"></i>
            </div>
            <div class="ml-3">
              <p class="text-sm text-blue-700">
                <strong>使用说明：</strong>输入VS
                Code插件的官网链接，系统将自动提取插件信息并生成下载链接
              </p>
            </div>
          </div>
        </div>

        <!-- URL输入 -->
        <div class="mb-6">
          <label
            for="pluginUrl"
            class="block text-sm font-medium text-gray-700 mb-2"
            >插件官网链接 <span class="text-red-500">*</span></label
          >
          <input
            type="text"
            id="pluginUrl"
            class="w-full rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            placeholder="https://marketplace.visualstudio.com/items?itemName=Vue.volar"
          />
          <p class="text-gray-500 text-xs mt-1">
            输入VS Code插件的官网链接，系统将自动提取发布者、插件名称和版本信息
          </p>
        </div>

        <button
          id="generateBtn"
          class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition-colors font-medium"
        >
          <i class="fas fa-link mr-2"></i>生成下载链接
        </button>
      </div>

      <!-- 结果区域 -->
      <div id="resultContainer" class="hidden fade-in">
        <!-- 平台无关链接 -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6 card-hover">
          <h2
            class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
          >
            <i class="fas fa-globe text-indigo-500 mr-2"></i>平台无关下载链接
          </h2>
          <div class="flex">
            <input
              type="text"
              id="platformIndependentLink"
              class="flex-1 rounded-l-lg border border-gray-300 px-4 py-3 bg-gray-50 text-gray-700"
              readonly
            />
            <button
              onclick="copyToClipboard('platformIndependentLink')"
              class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded-r-lg transition-colors"
            >
              <i class="fas fa-copy mr-2"></i>复制
            </button>
          </div>
        </div>

        <!-- 平台相关链接 -->
        <div class="bg-white rounded-xl shadow-md p-6 card-hover">
          <h2
            class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
          >
            <i class="fas fa-desktop text-indigo-500 mr-2"></i>平台相关下载链接
          </h2>
          <div class="flex">
            <input
              type="text"
              id="platformDependentLink"
              class="flex-1 rounded-l-lg border border-gray-300 px-4 py-3 bg-gray-50 text-gray-700"
              readonly
            />
            <button
              onclick="copyToClipboard('platformDependentLink')"
              class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded-r-lg transition-colors"
            >
              <i class="fas fa-copy mr-2"></i>复制
            </button>
          </div>
        </div>
      </div>

      <!-- 复制成功提示 -->
      <div
        id="copySuccess"
        class="hidden fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg"
      >
        <i class="fas fa-check-circle mr-2"></i>链接已复制
      </div>

      <!-- 提示消息容器 -->
      <div
        id="toastContainer"
        class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50"
      ></div>
    </div>

    <footer class="bg-gray-100 py-4 mt-8">
      <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
        <p>TvT</p>
      </div>
    </footer>

    <script>
      // 复制到剪贴板功能
      function copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        element.select();
        element.setSelectionRange(0, 99999);
        document.execCommand("copy");

        showToast("链接已成功复制到剪贴板");
      }

      // 显示提示消息
      function showToast(message) {
        const toastContainer = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.className =
          "toast bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg mb-2 flex items-center";
        toast.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
        toastContainer.appendChild(toast);

        // 3秒后自动移除
        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      // 显示错误消息
      function showError(message) {
        const toastContainer = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.className =
          "toast bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg mb-2 flex items-center";
        toast.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
        toastContainer.appendChild(toast);

        // 3秒后自动移除
        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      // 生成链接按钮点击事件
      document
        .getElementById("generateBtn")
        .addEventListener("click", async function () {
          const pluginUrl = document.getElementById("pluginUrl").value.trim();

          if (!pluginUrl) {
            showError("请输入插件官网链接");
            return;
          }

          // 显示加载状态
          const generateBtn = document.getElementById("generateBtn");
          const originalText = generateBtn.innerHTML;
          generateBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>正在获取插件信息...';
          generateBtn.disabled = true;

          try {
            // 调用后端API
            const response = await fetch("/extract-data", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ url: pluginUrl }),
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.detail || "获取插件信息失败");
            }

            const data = await response.json();

            if (!data.publisher || !data.unique_identifier || !data.version) {
              throw new Error("无法从链接中提取完整的插件信息");
            }

            // 生成平台无关链接
            const independentLink = `https://marketplace.visualstudio.com/_apis/public/gallery/publishers/${encodeURIComponent(
              data.publisher
            )}/vsextensions/${encodeURIComponent(
              data.unique_identifier
            )}/${encodeURIComponent(data.version)}/vspackage`;
            document.getElementById("platformIndependentLink").value =
              independentLink;

            // 生成平台相关链接（使用第一个平台作为示例）
            const platform = "win32-x64"; // 默认使用Windows x64
            const dependentLink = `https://marketplace.visualstudio.com/_apis/public/gallery/publishers/${encodeURIComponent(
              data.publisher
            )}/vsextensions/${encodeURIComponent(
              data.unique_identifier
            )}?targetPlatform=${encodeURIComponent(platform)}`;
            document.getElementById("platformDependentLink").value =
              dependentLink;

            // 显示结果区域
            document
              .getElementById("resultContainer")
              .classList.remove("hidden");

            // 滚动到结果区域
            document
              .getElementById("resultContainer")
              .scrollIntoView({ behavior: "smooth", block: "start" });

            showToast("插件信息获取成功，已生成下载链接");
          } catch (error) {
            console.error("Error:", error);
            showError(error.message || "获取插件信息时发生错误");
          } finally {
            // 恢复按钮状态
            generateBtn.innerHTML = originalText;
            generateBtn.disabled = false;
          }
        });
    </script>
  </body>
</html>
